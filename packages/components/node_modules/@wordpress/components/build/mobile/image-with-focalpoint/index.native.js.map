{"version":3,"sources":["@wordpress/components/src/mobile/image-with-focalpoint/index.native.js"],"names":["ImageWithFocalPoint","focalPoint","url","originalImageData","setOriginalImageData","containerSize","setContainerSize","Image","getSize","width","height","aspectRatio","onContainerLayout","event","nativeEvent","layout","getFocalPointOffset","imageRatio","container","imageSize","focusPoint","containerCenter","Math","floor","scaledImage","focus","focusOffset","offsetRest","containerRest","getImageStyles","imageStyle","horizontalOffset","verticalOffset","widthRatio","heightRatio","resizeMode","x","undefined","left","y","top","styles","image","uri"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { Image, View } from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { useState, useEffect, memo } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport styles from './style.scss';\n\nconst ImageWithFocalPoint = ( { focalPoint, url } ) => {\n\tconst [ originalImageData, setOriginalImageData ] = useState( null );\n\tconst [ containerSize, setContainerSize ] = useState( null );\n\n\tuseEffect( () => {\n\t\tif ( url ) {\n\t\t\tImage.getSize( url, ( width, height ) => {\n\t\t\t\tsetOriginalImageData( {\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t\taspectRatio: width / height,\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\t}, [ url ] );\n\n\tconst onContainerLayout = ( event ) => {\n\t\tconst { height, width } = event.nativeEvent.layout;\n\t\tsetContainerSize( { width, height } );\n\t};\n\n\tconst getFocalPointOffset = (\n\t\timageRatio,\n\t\tcontainer,\n\t\timageSize,\n\t\tfocusPoint\n\t) => {\n\t\tconst containerCenter = Math.floor( container / 2 );\n\t\tconst scaledImage = Math.floor( imageSize / imageRatio );\n\t\tconst focus = Math.floor( focusPoint * scaledImage );\n\t\tlet focusOffset = focus - containerCenter;\n\t\tconst offsetRest = scaledImage - focus;\n\t\tconst containerRest = container - containerCenter;\n\n\t\tif ( offsetRest < containerRest ) {\n\t\t\tfocusOffset -= containerRest - offsetRest;\n\t\t}\n\n\t\tif ( focusOffset < 0 ) {\n\t\t\tfocusOffset = 0;\n\t\t}\n\n\t\treturn -focusOffset;\n\t};\n\n\tconst getImageStyles = () => {\n\t\tconst imageStyle = {};\n\t\tif ( focalPoint && containerSize && originalImageData ) {\n\t\t\tlet horizontalOffset = 0;\n\t\t\tlet verticalOffset = 0;\n\t\t\tconst widthRatio = originalImageData.width / containerSize.width;\n\t\t\tconst heightRatio = originalImageData.height / containerSize.height;\n\n\t\t\timageStyle.resizeMode = 'stretch';\n\n\t\t\tif ( widthRatio > heightRatio ) {\n\t\t\t\thorizontalOffset = getFocalPointOffset(\n\t\t\t\t\theightRatio,\n\t\t\t\t\tcontainerSize.width,\n\t\t\t\t\toriginalImageData.width,\n\t\t\t\t\tfocalPoint.x\n\t\t\t\t);\n\t\t\t\timageStyle.width = undefined;\n\t\t\t\timageStyle.left = horizontalOffset;\n\t\t\t} else if ( widthRatio < heightRatio ) {\n\t\t\t\tverticalOffset = getFocalPointOffset(\n\t\t\t\t\twidthRatio,\n\t\t\t\t\tcontainerSize.height,\n\t\t\t\t\toriginalImageData.height,\n\t\t\t\t\tfocalPoint.y\n\t\t\t\t);\n\t\t\t\timageStyle.height = undefined;\n\t\t\t\timageStyle.top = verticalOffset;\n\t\t\t}\n\n\t\t\treturn imageStyle;\n\t\t}\n\n\t\treturn imageStyle;\n\t};\n\n\treturn (\n\t\t<View style={ styles.container } onLayout={ onContainerLayout }>\n\t\t\t<Image\n\t\t\t\taspectRatio={ originalImageData?.aspectRatio }\n\t\t\t\tstyle={ [\n\t\t\t\t\tstyles.image,\n\t\t\t\t\t{ height: containerSize?.height },\n\t\t\t\t\tgetImageStyles(),\n\t\t\t\t] }\n\t\t\t\tsource={ { uri: url } }\n\t\t\t/>\n\t\t</View>\n\t);\n};\n\nexport default memo( ImageWithFocalPoint );\n"]}