{"version":3,"sources":["@wordpress/components/src/tooltip/index.js"],"names":["debounce","includes","Component","Children","cloneElement","concatChildren","Popover","Shortcut","TOOLTIP_DELAY","Tooltip","arguments","delayedSetIsOver","isOver","setState","cancelIsMouseDown","createSetIsMouseDown","isInMouseDown","state","cancel","document","removeEventListener","eventName","event","children","props","count","child","only","isDelayed","emitToChild","currentTarget","disabled","type","isMouseDown","position","text","shortcut","process","env","NODE_ENV","console","error","onMouseEnter","createToggleIsOver","onMouseLeave","onClick","onFocus","onBlur","onMouseDown"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { debounce, includes } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tComponent,\n\tChildren,\n\tcloneElement,\n\tconcatChildren,\n} from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport Popover from '../popover';\nimport Shortcut from '../shortcut';\n\n/**\n * Time over children to wait before showing tooltip\n *\n * @type {number}\n */\nconst TOOLTIP_DELAY = 700;\n\nclass Tooltip extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.delayedSetIsOver = debounce(\n\t\t\t( isOver ) => this.setState( { isOver } ),\n\t\t\tTOOLTIP_DELAY\n\t\t);\n\n\t\t/**\n\t\t * Prebound `isInMouseDown` handler, created as a constant reference to\n\t\t * assure ability to remove in component unmount.\n\t\t *\n\t\t * @type {Function}\n\t\t */\n\t\tthis.cancelIsMouseDown = this.createSetIsMouseDown( false );\n\n\t\t/**\n\t\t * Whether a the mouse is currently pressed, used in determining whether\n\t\t * to handle a focus event as displaying the tooltip immediately.\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tthis.isInMouseDown = false;\n\n\t\tthis.state = {\n\t\t\tisOver: false,\n\t\t};\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.delayedSetIsOver.cancel();\n\n\t\tdocument.removeEventListener( 'mouseup', this.cancelIsMouseDown );\n\t}\n\n\temitToChild( eventName, event ) {\n\t\tconst { children } = this.props;\n\t\tif ( Children.count( children ) !== 1 ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst child = Children.only( children );\n\t\tif ( typeof child.props[ eventName ] === 'function' ) {\n\t\t\tchild.props[ eventName ]( event );\n\t\t}\n\t}\n\n\tcreateToggleIsOver( eventName, isDelayed ) {\n\t\treturn ( event ) => {\n\t\t\t// Preserve original child callback behavior\n\t\t\tthis.emitToChild( eventName, event );\n\n\t\t\t// Mouse events behave unreliably in React for disabled elements,\n\t\t\t// firing on mouseenter but not mouseleave.  Further, the default\n\t\t\t// behavior for disabled elements in some browsers is to ignore\n\t\t\t// mouse events. Don't bother trying to to handle them.\n\t\t\t//\n\t\t\t// See: https://github.com/facebook/react/issues/4251\n\t\t\tif ( event.currentTarget.disabled ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// A focus event will occur as a result of a mouse click, but it\n\t\t\t// should be disambiguated between interacting with the button and\n\t\t\t// using an explicit focus shift as a cue to display the tooltip.\n\t\t\tif ( 'focus' === event.type && this.isInMouseDown ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Needed in case unsetting is over while delayed set pending, i.e.\n\t\t\t// quickly blur/mouseleave before delayedSetIsOver is called\n\t\t\tthis.delayedSetIsOver.cancel();\n\n\t\t\tconst isOver = includes( [ 'focus', 'mouseenter' ], event.type );\n\t\t\tif ( isOver === this.state.isOver ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( isDelayed ) {\n\t\t\t\tthis.delayedSetIsOver( isOver );\n\t\t\t} else {\n\t\t\t\tthis.setState( { isOver } );\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Creates an event callback to handle assignment of the `isInMouseDown`\n\t * instance property in response to a `mousedown` or `mouseup` event.\n\t *\n\t * @param {boolean} isMouseDown Whether handler is to be created for the\n\t *                              `mousedown` event, as opposed to `mouseup`.\n\t *\n\t * @return {Function} Event callback handler.\n\t */\n\tcreateSetIsMouseDown( isMouseDown ) {\n\t\treturn ( event ) => {\n\t\t\t// Preserve original child callback behavior\n\t\t\tthis.emitToChild(\n\t\t\t\tisMouseDown ? 'onMouseDown' : 'onMouseUp',\n\t\t\t\tevent\n\t\t\t);\n\n\t\t\t// On mouse down, the next `mouseup` should revert the value of the\n\t\t\t// instance property and remove its own event handler. The bind is\n\t\t\t// made on the document since the `mouseup` might not occur within\n\t\t\t// the bounds of the element.\n\t\t\tdocument[\n\t\t\t\tisMouseDown ? 'addEventListener' : 'removeEventListener'\n\t\t\t]( 'mouseup', this.cancelIsMouseDown );\n\n\t\t\tthis.isInMouseDown = isMouseDown;\n\t\t};\n\t}\n\n\trender() {\n\t\tconst { children, position, text, shortcut } = this.props;\n\t\tif ( Children.count( children ) !== 1 ) {\n\t\t\tif ( 'development' === process.env.NODE_ENV ) {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error(\n\t\t\t\t\t'Tooltip should be called with only a single child element.'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn children;\n\t\t}\n\n\t\tconst child = Children.only( children );\n\t\tconst { isOver } = this.state;\n\t\treturn cloneElement( child, {\n\t\t\tonMouseEnter: this.createToggleIsOver( 'onMouseEnter', true ),\n\t\t\tonMouseLeave: this.createToggleIsOver( 'onMouseLeave' ),\n\t\t\tonClick: this.createToggleIsOver( 'onClick' ),\n\t\t\tonFocus: this.createToggleIsOver( 'onFocus' ),\n\t\t\tonBlur: this.createToggleIsOver( 'onBlur' ),\n\t\t\tonMouseDown: this.createSetIsMouseDown( true ),\n\t\t\tchildren: concatChildren(\n\t\t\t\tchild.props.children,\n\t\t\t\tisOver && (\n\t\t\t\t\t<Popover\n\t\t\t\t\t\tfocusOnMount={ false }\n\t\t\t\t\t\tposition={ position }\n\t\t\t\t\t\tclassName=\"components-tooltip\"\n\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\tanimate={ false }\n\t\t\t\t\t\tnoArrow={ true }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ text }\n\t\t\t\t\t\t<Shortcut\n\t\t\t\t\t\t\tclassName=\"components-tooltip__shortcut\"\n\t\t\t\t\t\t\tshortcut={ shortcut }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Popover>\n\t\t\t\t)\n\t\t\t),\n\t\t} );\n\t}\n}\n\nexport default Tooltip;\n"]}