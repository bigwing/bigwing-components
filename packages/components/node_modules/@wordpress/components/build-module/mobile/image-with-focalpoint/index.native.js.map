{"version":3,"sources":["@wordpress/components/src/mobile/image-with-focalpoint/index.native.js"],"names":["Image","View","useState","useEffect","memo","styles","ImageWithFocalPoint","focalPoint","url","originalImageData","setOriginalImageData","containerSize","setContainerSize","getSize","width","height","aspectRatio","onContainerLayout","event","nativeEvent","layout","getFocalPointOffset","imageRatio","container","imageSize","focusPoint","containerCenter","Math","floor","scaledImage","focus","focusOffset","offsetRest","containerRest","getImageStyles","imageStyle","horizontalOffset","verticalOffset","widthRatio","heightRatio","resizeMode","x","undefined","left","y","top","image","uri"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { Image, View } from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { useState, useEffect, memo } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport styles from './style.scss';\n\nconst ImageWithFocalPoint = ( { focalPoint, url } ) => {\n\tconst [ originalImageData, setOriginalImageData ] = useState( null );\n\tconst [ containerSize, setContainerSize ] = useState( null );\n\n\tuseEffect( () => {\n\t\tif ( url ) {\n\t\t\tImage.getSize( url, ( width, height ) => {\n\t\t\t\tsetOriginalImageData( {\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t\taspectRatio: width / height,\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\t}, [ url ] );\n\n\tconst onContainerLayout = ( event ) => {\n\t\tconst { height, width } = event.nativeEvent.layout;\n\t\tsetContainerSize( { width, height } );\n\t};\n\n\tconst getFocalPointOffset = (\n\t\timageRatio,\n\t\tcontainer,\n\t\timageSize,\n\t\tfocusPoint\n\t) => {\n\t\tconst containerCenter = Math.floor( container / 2 );\n\t\tconst scaledImage = Math.floor( imageSize / imageRatio );\n\t\tconst focus = Math.floor( focusPoint * scaledImage );\n\t\tlet focusOffset = focus - containerCenter;\n\t\tconst offsetRest = scaledImage - focus;\n\t\tconst containerRest = container - containerCenter;\n\n\t\tif ( offsetRest < containerRest ) {\n\t\t\tfocusOffset -= containerRest - offsetRest;\n\t\t}\n\n\t\tif ( focusOffset < 0 ) {\n\t\t\tfocusOffset = 0;\n\t\t}\n\n\t\treturn -focusOffset;\n\t};\n\n\tconst getImageStyles = () => {\n\t\tconst imageStyle = {};\n\t\tif ( focalPoint && containerSize && originalImageData ) {\n\t\t\tlet horizontalOffset = 0;\n\t\t\tlet verticalOffset = 0;\n\t\t\tconst widthRatio = originalImageData.width / containerSize.width;\n\t\t\tconst heightRatio = originalImageData.height / containerSize.height;\n\n\t\t\timageStyle.resizeMode = 'stretch';\n\n\t\t\tif ( widthRatio > heightRatio ) {\n\t\t\t\thorizontalOffset = getFocalPointOffset(\n\t\t\t\t\theightRatio,\n\t\t\t\t\tcontainerSize.width,\n\t\t\t\t\toriginalImageData.width,\n\t\t\t\t\tfocalPoint.x\n\t\t\t\t);\n\t\t\t\timageStyle.width = undefined;\n\t\t\t\timageStyle.left = horizontalOffset;\n\t\t\t} else if ( widthRatio < heightRatio ) {\n\t\t\t\tverticalOffset = getFocalPointOffset(\n\t\t\t\t\twidthRatio,\n\t\t\t\t\tcontainerSize.height,\n\t\t\t\t\toriginalImageData.height,\n\t\t\t\t\tfocalPoint.y\n\t\t\t\t);\n\t\t\t\timageStyle.height = undefined;\n\t\t\t\timageStyle.top = verticalOffset;\n\t\t\t}\n\n\t\t\treturn imageStyle;\n\t\t}\n\n\t\treturn imageStyle;\n\t};\n\n\treturn (\n\t\t<View style={ styles.container } onLayout={ onContainerLayout }>\n\t\t\t<Image\n\t\t\t\taspectRatio={ originalImageData?.aspectRatio }\n\t\t\t\tstyle={ [\n\t\t\t\t\tstyles.image,\n\t\t\t\t\t{ height: containerSize?.height },\n\t\t\t\t\tgetImageStyles(),\n\t\t\t\t] }\n\t\t\t\tsource={ { uri: url } }\n\t\t\t/>\n\t\t</View>\n\t);\n};\n\nexport default memo( ImageWithFocalPoint );\n"]}