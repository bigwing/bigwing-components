{"version":3,"sources":["@wordpress/components/src/custom-gradient-picker/custom-gradient-bar.js"],"names":["some","classnames","useRef","useReducer","useState","plusCircle","Button","ColorPicker","Dropdown","ControlPoints","INSERT_POINT_WIDTH","COLOR_POPOVER_PROPS","MINIMUM_DISTANCE_BETWEEN_POINTS","serializeGradient","getGradientWithColorAtPositionChanged","getGradientWithColorStopAdded","getHorizontalRelativeGradientPosition","getMarkerPoints","getGradientParsed","getLinearGradientRepresentationOfARadial","InsertPoint","onChange","gradientAST","onOpenInserter","onCloseInserter","insertPosition","alreadyInsertedPoint","setAlreadyInsertedPoint","isOpen","onToggle","left","undefined","rgb","newGradient","customGradientBarReducer","state","action","type","id","customGradientBarReducerInitialState","CustomGradientBar","value","gradientValue","hasGradient","onGradientStructureChange","newGradientStructure","gradientPickerDomRef","markerPoints","gradientBarState","gradientBarStateDispatch","onMouseEnterAndMove","event","clientX","current","positionValue","Math","abs","onMouseLeave","isMovingInserter","isInsertingControlPoint","background"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\n\nimport { some } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { useRef, useReducer, useState } from '@wordpress/element';\nimport { plusCircle } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport Button from '../button';\nimport ColorPicker from '../color-picker';\nimport Dropdown from '../dropdown';\nimport ControlPoints from './control-points';\nimport {\n\tINSERT_POINT_WIDTH,\n\tCOLOR_POPOVER_PROPS,\n\tMINIMUM_DISTANCE_BETWEEN_POINTS,\n} from './constants';\nimport { serializeGradient } from './serializer';\nimport {\n\tgetGradientWithColorAtPositionChanged,\n\tgetGradientWithColorStopAdded,\n\tgetHorizontalRelativeGradientPosition,\n\tgetMarkerPoints,\n\tgetGradientParsed,\n\tgetLinearGradientRepresentationOfARadial,\n} from './utils';\n\nfunction InsertPoint( {\n\tonChange,\n\tgradientAST,\n\tonOpenInserter,\n\tonCloseInserter,\n\tinsertPosition,\n} ) {\n\tconst [ alreadyInsertedPoint, setAlreadyInsertedPoint ] = useState( false );\n\treturn (\n\t\t<Dropdown\n\t\t\tclassName=\"components-custom-gradient-picker__inserter\"\n\t\t\tonClose={ () => {\n\t\t\t\tonCloseInserter();\n\t\t\t} }\n\t\t\trenderToggle={ ( { isOpen, onToggle } ) => (\n\t\t\t\t<Button\n\t\t\t\t\taria-expanded={ isOpen }\n\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\tif ( isOpen ) {\n\t\t\t\t\t\t\tonCloseInserter();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetAlreadyInsertedPoint( false );\n\t\t\t\t\t\t\tonOpenInserter();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonToggle();\n\t\t\t\t\t} }\n\t\t\t\t\tclassName=\"components-custom-gradient-picker__insert-point\"\n\t\t\t\t\ticon={ plusCircle }\n\t\t\t\t\tstyle={ {\n\t\t\t\t\t\tleft:\n\t\t\t\t\t\t\tinsertPosition !== null\n\t\t\t\t\t\t\t\t? `${ insertPosition }%`\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t) }\n\t\t\trenderContent={ () => (\n\t\t\t\t<ColorPicker\n\t\t\t\t\tonChangeComplete={ ( { rgb } ) => {\n\t\t\t\t\t\tlet newGradient;\n\t\t\t\t\t\tif ( alreadyInsertedPoint ) {\n\t\t\t\t\t\t\tnewGradient = getGradientWithColorAtPositionChanged(\n\t\t\t\t\t\t\t\tgradientAST,\n\t\t\t\t\t\t\t\tinsertPosition,\n\t\t\t\t\t\t\t\trgb\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnewGradient = getGradientWithColorStopAdded(\n\t\t\t\t\t\t\t\tgradientAST,\n\t\t\t\t\t\t\t\tinsertPosition,\n\t\t\t\t\t\t\t\trgb\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tsetAlreadyInsertedPoint( true );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonChange( newGradient );\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t) }\n\t\t\tpopoverProps={ COLOR_POPOVER_PROPS }\n\t\t/>\n\t);\n}\n\nfunction customGradientBarReducer( state, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'MOVE_INSERTER':\n\t\t\tif ( state.id === 'IDLE' || state.id === 'MOVING_INSERTER' ) {\n\t\t\t\treturn {\n\t\t\t\t\tid: 'MOVING_INSERTER',\n\t\t\t\t\tinsertPosition: action.insertPosition,\n\t\t\t\t};\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'STOP_INSERTER_MOVE':\n\t\t\tif ( state.id === 'MOVING_INSERTER' ) {\n\t\t\t\treturn {\n\t\t\t\t\tid: 'IDLE',\n\t\t\t\t};\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'OPEN_INSERTER':\n\t\t\tif ( state.id === 'MOVING_INSERTER' ) {\n\t\t\t\treturn {\n\t\t\t\t\tid: 'INSERTING_CONTROL_POINT',\n\t\t\t\t\tinsertPosition: state.insertPosition,\n\t\t\t\t};\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'CLOSE_INSERTER':\n\t\t\tif ( state.id === 'INSERTING_CONTROL_POINT' ) {\n\t\t\t\treturn {\n\t\t\t\t\tid: 'IDLE',\n\t\t\t\t};\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'START_CONTROL_CHANGE':\n\t\t\tif ( state.id === 'IDLE' ) {\n\t\t\t\treturn {\n\t\t\t\t\tid: 'MOVING_CONTROL_POINT',\n\t\t\t\t};\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'STOP_CONTROL_CHANGE':\n\t\t\tif ( state.id === 'MOVING_CONTROL_POINT' ) {\n\t\t\t\treturn {\n\t\t\t\t\tid: 'IDLE',\n\t\t\t\t};\n\t\t\t}\n\t\t\tbreak;\n\t}\n\treturn state;\n}\nconst customGradientBarReducerInitialState = { id: 'IDLE' };\n\nexport default function CustomGradientBar( { value, onChange } ) {\n\tconst { gradientAST, gradientValue, hasGradient } = getGradientParsed(\n\t\tvalue\n\t);\n\n\tconst onGradientStructureChange = ( newGradientStructure ) => {\n\t\tonChange( serializeGradient( newGradientStructure ) );\n\t};\n\n\tconst gradientPickerDomRef = useRef();\n\tconst markerPoints = getMarkerPoints( gradientAST );\n\n\tconst [ gradientBarState, gradientBarStateDispatch ] = useReducer(\n\t\tcustomGradientBarReducer,\n\t\tcustomGradientBarReducerInitialState\n\t);\n\tconst onMouseEnterAndMove = ( event ) => {\n\t\tconst insertPosition = getHorizontalRelativeGradientPosition(\n\t\t\tevent.clientX,\n\t\t\tgradientPickerDomRef.current,\n\t\t\tINSERT_POINT_WIDTH\n\t\t);\n\n\t\t// If the insert point is close to an existing control point don't show it.\n\t\tif (\n\t\t\tsome( markerPoints, ( { positionValue } ) => {\n\t\t\t\treturn (\n\t\t\t\t\tMath.abs( insertPosition - positionValue ) <\n\t\t\t\t\tMINIMUM_DISTANCE_BETWEEN_POINTS\n\t\t\t\t);\n\t\t\t} )\n\t\t) {\n\t\t\tif ( gradientBarState.id === 'MOVING_INSERTER' ) {\n\t\t\t\tgradientBarStateDispatch( { type: 'STOP_INSERTER_MOVE' } );\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tgradientBarStateDispatch( { type: 'MOVE_INSERTER', insertPosition } );\n\t};\n\n\tconst onMouseLeave = () => {\n\t\tgradientBarStateDispatch( { type: 'STOP_INSERTER_MOVE' } );\n\t};\n\n\tconst isMovingInserter = gradientBarState.id === 'MOVING_INSERTER';\n\tconst isInsertingControlPoint =\n\t\tgradientBarState.id === 'INSERTING_CONTROL_POINT';\n\n\treturn (\n\t\t<div\n\t\t\tref={ gradientPickerDomRef }\n\t\t\tclassName={ classnames(\n\t\t\t\t'components-custom-gradient-picker__gradient-bar',\n\t\t\t\t{ 'has-gradient': hasGradient }\n\t\t\t) }\n\t\t\tonMouseEnter={ onMouseEnterAndMove }\n\t\t\tonMouseMove={ onMouseEnterAndMove }\n\t\t\t// On radial gradients the bar should display a linear gradient.\n\t\t\t// On radial gradients the bar represents a slice of the gradient from the center until the outside.\n\t\t\tstyle={ {\n\t\t\t\tbackground:\n\t\t\t\t\tgradientAST.type === 'radial-gradient'\n\t\t\t\t\t\t? getLinearGradientRepresentationOfARadial(\n\t\t\t\t\t\t\t\tgradientAST\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: gradientValue,\n\t\t\t} }\n\t\t\tonMouseLeave={ onMouseLeave }\n\t\t>\n\t\t\t<div className=\"components-custom-gradient-picker__markers-container\">\n\t\t\t\t{ ( isMovingInserter || isInsertingControlPoint ) && (\n\t\t\t\t\t<InsertPoint\n\t\t\t\t\t\tinsertPosition={ gradientBarState.insertPosition }\n\t\t\t\t\t\tonChange={ onGradientStructureChange }\n\t\t\t\t\t\tgradientAST={ gradientAST }\n\t\t\t\t\t\tonOpenInserter={ () => {\n\t\t\t\t\t\t\tgradientBarStateDispatch( {\n\t\t\t\t\t\t\t\ttype: 'OPEN_INSERTER',\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tonCloseInserter={ () => {\n\t\t\t\t\t\t\tgradientBarStateDispatch( {\n\t\t\t\t\t\t\t\ttype: 'CLOSE_INSERTER',\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t\t<ControlPoints\n\t\t\t\t\tgradientPickerDomRef={ gradientPickerDomRef }\n\t\t\t\t\tignoreMarkerPosition={\n\t\t\t\t\t\tisInsertingControlPoint\n\t\t\t\t\t\t\t? gradientBarState.insertPosition\n\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t}\n\t\t\t\t\tmarkerPoints={ markerPoints }\n\t\t\t\t\tonChange={ onGradientStructureChange }\n\t\t\t\t\tgradientAST={ gradientAST }\n\t\t\t\t\tonStartControlPointChange={ () => {\n\t\t\t\t\t\tgradientBarStateDispatch( {\n\t\t\t\t\t\t\ttype: 'START_CONTROL_CHANGE',\n\t\t\t\t\t\t} );\n\t\t\t\t\t} }\n\t\t\t\t\tonStopControlPointChange={ () => {\n\t\t\t\t\t\tgradientBarStateDispatch( {\n\t\t\t\t\t\t\ttype: 'STOP_CONTROL_CHANGE',\n\t\t\t\t\t\t} );\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n"]}