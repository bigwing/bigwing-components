{"version":3,"sources":["@wordpress/data/src/components/use-dispatch/use-dispatch-with-map.js"],"names":["mapValues","useMemo","useRef","useEffect","useLayoutEffect","useRegistry","useIsomorphicLayoutEffect","window","useDispatchWithMap","dispatchMap","deps","registry","currentDispatchMap","current","currentDispatchProps","dispatch","dispatcher","propName","console","warn"],"mappings":";;AAAA;;;AAGA,SAASA,SAAT,QAA0B,QAA1B;AAEA;;;;AAGA,SACCC,OADD,EAECC,MAFD,EAGCC,SAHD,EAICC,eAJD,QAKO,oBALP;AAOA;;;;AAGA,OAAOC,WAAP,MAAwB,mCAAxB;AAEA;;;;;;;;;;AASA,IAAMC,yBAAyB,GAC9B,OAAOC,MAAP,KAAkB,WAAlB,GAAgCH,eAAhC,GAAkDD,SADnD;AAGA;;;;;;;;;;;;;;;AAcA,IAAMK,kBAAkB,GAAG,SAArBA,kBAAqB,CAAEC,WAAF,EAAeC,IAAf,EAAyB;AACnD,MAAMC,QAAQ,GAAGN,WAAW,EAA5B;AACA,MAAMO,kBAAkB,GAAGV,MAAM,CAAEO,WAAF,CAAjC;AAEAH,EAAAA,yBAAyB,CAAE,YAAM;AAChCM,IAAAA,kBAAkB,CAACC,OAAnB,GAA6BJ,WAA7B;AACA,GAFwB,CAAzB;AAIA,SAAOR,OAAO,CAAE,YAAM;AACrB,QAAMa,oBAAoB,GAAGF,kBAAkB,CAACC,OAAnB,CAC5BF,QAAQ,CAACI,QADmB,EAE5BJ,QAF4B,CAA7B;AAIA,WAAOX,SAAS,CAAEc,oBAAF,EAAwB,UAAEE,UAAF,EAAcC,QAAd,EAA4B;AACnE,UAAK,OAAOD,UAAP,KAAsB,UAA3B,EAAwC;AACvC;AACAE,QAAAA,OAAO,CAACC,IAAR,oBACcF,QADd;AAGA;;AACD,aAAO;AAAA;;AAAA,eACN,yBAAAL,kBAAkB,CAChBC,OADF,CACWF,QAAQ,CAACI,QADpB,EAC8BJ,QAD9B,GAEGM,QAFH,yCADM;AAAA,OAAP;AAIA,KAXe,CAAhB;AAYA,GAjBa,GAiBTN,QAjBS,4BAiBID,IAjBJ,GAAd;AAkBA,CA1BD;;AA4BA,eAAeF,kBAAf","sourcesContent":["/**\n * External dependencies\n */\nimport { mapValues } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tuseMemo,\n\tuseRef,\n\tuseEffect,\n\tuseLayoutEffect,\n} from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport useRegistry from '../registry-provider/use-registry';\n\n/**\n * Favor useLayoutEffect to ensure the store subscription callback always has\n * the dispatchMap from the latest render. If a store update happens between\n * render and the effect, this could cause missed/stale updates or\n * inconsistent state.\n *\n * Fallback to useEffect for server rendered components because currently React\n * throws a warning when using useLayoutEffect in that environment.\n */\nconst useIsomorphicLayoutEffect =\n\ttypeof window !== 'undefined' ? useLayoutEffect : useEffect;\n\n/**\n * Custom react hook for returning aggregate dispatch actions using the provided\n * dispatchMap.\n *\n * Currently this is an internal api only and is implemented by `withDispatch`\n *\n * @param {Function} dispatchMap  Receives the `registry.dispatch` function as\n *                                the first argument and the `registry` object\n *                                as the second argument.  Should return an\n *                                object mapping props to functions.\n * @param {Array}    deps         An array of dependencies for the hook.\n * @return {Object}  An object mapping props to functions created by the passed\n *                   in dispatchMap.\n */\nconst useDispatchWithMap = ( dispatchMap, deps ) => {\n\tconst registry = useRegistry();\n\tconst currentDispatchMap = useRef( dispatchMap );\n\n\tuseIsomorphicLayoutEffect( () => {\n\t\tcurrentDispatchMap.current = dispatchMap;\n\t} );\n\n\treturn useMemo( () => {\n\t\tconst currentDispatchProps = currentDispatchMap.current(\n\t\t\tregistry.dispatch,\n\t\t\tregistry\n\t\t);\n\t\treturn mapValues( currentDispatchProps, ( dispatcher, propName ) => {\n\t\t\tif ( typeof dispatcher !== 'function' ) {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`Property ${ propName } returned from dispatchMap in useDispatchWithMap must be a function.`\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn ( ...args ) =>\n\t\t\t\tcurrentDispatchMap\n\t\t\t\t\t.current( registry.dispatch, registry )\n\t\t\t\t\t[ propName ]( ...args );\n\t\t} );\n\t}, [ registry, ...deps ] );\n};\n\nexport default useDispatchWithMap;\n"]}